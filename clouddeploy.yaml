apiVersion: deploy.cloud.google.com/v1
kind: DeliveryPipeline
metadata:
  name: my-run-demo-app-1
description: main application pipeline
serialPipeline:
  stages:
  - targetId: run-dev
    profiles: [dev]
    strategy:
      standard:
        verify: true
        postdeploy:
          actions: ["postdeploy-make-cloud-run-services-public"]
  - targetId: run-prod-multi
    profiles: [prod]
    strategy:
      canary:
        runtimeConfig:
          cloudRun:
            automaticTrafficControl: true
        canaryDeployment:
          percentages: [10, 50]
          verify: false
          postdeploy:
            actions: ["postdeploy-make-cloud-run-services-public"]
---

apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: run-dev
description: Cloud Run development service
run:
  location: projects/iwanariy-cd-update-2023/locations/asia-northeast1
---

apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
 name: run-prod-multi
description: Cloud Run production service in Tokyo and Osaka
multiTarget:
 targetIds: [ run-prod-tok, run-prod-osa ]

---
apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: run-prod-tok
description: Cloud Run production service in Tokyo
run:
  location: projects/iwanariy-cd-update-2023/locations/asia-northeast1

---
apiVersion: deploy.cloud.google.com/v1
kind: Target
metadata:
  name: run-prod-osa
description: Cloud Run production service in Osaka
run:
  location: projects/iwanariy-cd-update-2023/locations/asia-northeast2